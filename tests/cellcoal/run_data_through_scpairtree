DATADIR=~/work/sc_pairtree/tests/cellcoal/data/ISM
BINDIR=~/work/sc_pairtree/bin
RESDIR=~/work/sc_pairtree/tests/cellcoal/results/ISM/sc_pairtree
FIGDIR=~/work/sc_pairtree/tests/cellcoal/results/ISM/sc_pairtree/figs
LOGDIR=~/work/sc_pairtree/tests/cellcoal/results/ISM/sc_pairtree/logs


function run_all_sims {

  d_rng_id=2
  n_data_rep=1 #20
  n_mcmc_rep=8
  thin_frac=0.25
  burnin=0.75

  #convergence parameters
  # conv_thresh=0.1
  # conv_min_samp=1000 #per chain
  # check_conv_every=100
  
  #If passing error rates directly to scPairtree, rather than estimating from data
  use_true_error_rates=false

  #Original dataset
  for n_mut in 50; do
  for n_cell in 500; do 
  for FPR in 0.001; do
  for ADR in 0.25; do
  for sim in $(seq 1 $n_data_rep); do
    echo $n_mut $n_cell $sim
    
    seed=`expr 1000 + $sim`

    fn=m${n_mut}_c${n_cell}_fp${FPR}_ad${ADR}

    data_fn=$DATADIR/$fn/processed/data.$(printf "%04d" $sim)
    if $use_true_error_rates; then
      out_fn=$RESDIR/${fn}_act_error_rates
      log_fn=$LOGDIR/${fn}_act_error_rates.log
      fig_fn=$FIGDIR/${fn}_act_error_rates/
    else
      out_fn=$RESDIR/${fn}.$(printf "%04d" $sim) # _est_error_rates
      log_fn=$LOGDIR/${fn}.$(printf "%04d" $sim) # _est_error_rates.log
      fig_fn=$FIGDIR/${fn}.$(printf "%04d" $sim) # _est_error_rates/
    fi
    
    tpc=`expr $n_mut \* 1000`
    # if $use_true_error_rates; then
    #   bsub -n8 -R rusage[mem=4] -W 48:00 -oo $log_fn \
    #     \time -o $out_fn.time -f "Runtime: %E\n" \
    #       python $BINDIR/sc_pairtree.py $data_fn \
    #                                         $out_fn \
    #                                         --seed $seed \
    #                                         --data-range $d_rng_id \
    #                                         --parallel $n_mcmc_rep \
    #                                         --trees-per-chain $tpc \
    #                                         --burnin $burnin \
    #                                         --thinned-frac $thin_frac \
    #                                         --adr $ADR \
    #                                         --fpr $FPR \
    #                                         --rerun \
    #                                         # --convergence-threshold $conv_thresh \
    #                                         # --convergence-min-nsamples $conv_min_samp \
    #                                         # --check-convergence-every $check_conv_every \

    # else
    #   bsub -n10 -R rusage[mem=8] -W 48:00 -oo $log_fn.log \
    #     \time -o $log_fn.time -f "Runtime: %E\n" \
    #       python $BINDIR/sc_pairtree.py $data_fn \
    #                                         $out_fn \
    #                                         --seed $seed \
    #                                         --data-range $d_rng_id \
    #                                         --parallel $n_mcmc_rep \
    #                                         --trees-per-chain $tpc \
    #                                         --burnin $burnin \
    #                                         --thinned-frac $thin_frac \
    #                                         --rerun
    #                                         # --convergence-threshold $conv_thresh \
    #                                         # --convergence-min-nsamples $conv_min_samp \
    #                                         # --check-convergence-every $check_conv_every \
    # fi
                                          
    python $BINDIR/make_supp_figures.py $out_fn --outdir $fig_fn --seed $seed # --act-tree-adj $act_mut_adj_fn
  done
  done
  done
  done
  done
}

function main {
  run_all_sims
}

main