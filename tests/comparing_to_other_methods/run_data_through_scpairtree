SIMDIR=~/work/sc_pairtree/tests/comparing_to_other_methods/sims/data
BINDIR=~/work/sc_pairtree/bin
RESDIR=~/work/sc_pairtree/tests/comparing_to_other_methods/results/sc_pairtree
LOGDIR=~/work/sc_pairtree/tests/comparing_to_other_methods/results/sc_pairtree/logs


function run_all_sims {

  FPR=0.001
  ADO=0.3
  cell_alpha=1
  mut_alpha=1
  d_rng_id=1
  n_rep=8
  thin_frac=0.25
  burnin=0.75
  min_cells_per_node=2 #5

  #convergence parameters
  conv_thresh=0.1
  conv_min_samp=1000 #per chain
  check_conv_every=100
  
  #Original dataset
  #For min_cells_per_node=5
  # min_cells_per_node=5
  # for M in 10 20 50 100 200; do
  # for cmult in 5 10 20 50 100; do
  #For min_cells_per_node=2
  # min_cells_per_node=2
  # for M in 20 50 100 200; do
  # for cmult in 5 10 20 50; do 
  # for FPR in 0.001; do
  # for ADO in 0.3; do
  # for sim in 0 1 2 3 4 5 6 7 8 9; do
  #For varying error rates
  # min_cells_per_node=2
  # for M in 100; do
  # for cmult in 5; do #5 50; do
  # for FPR in 0.001 0.01 0.1; do
  # for ADO in 0.1 0.3 0.5; do
  # for sim in 0 1 2 3 4 5 6 7 8 9; do
  #Custom
  min_cells_per_node=2
  for M in 100; do
  for cmult in 5; do 
  for FPR in 0.001; do
  for ADO in 0.3; do
  for sim in 0 1 2 3 4 5 6 7 8 9; do
    C=`expr $M \* $cmult`
    echo $M $C $sim
    seed=`expr 1000 + $sim`
    fn=m${M}_c${C}_fp${FPR}_ad${ADO}_ca${cell_alpha}_ma${mut_alpha}_dr${d_rng_id}_mc${min_cells_per_node}_seed${seed}
    # fn=m${M}_c${C}_fp${FPR}_ad${ADO}_ca${cell_alpha}_ma${mut_alpha}_dr${d_rng_id}_seed${seed}
    data_fn=$SIMDIR/$fn.data
    out_fn=$RESDIR/$fn
    log_fn=$LOGDIR/$fn.log
    fig_fn=$RESDIR/figs/$fn/
    act_adj_fn=$SIMDIR/$fn.adj
    act_mut_adj_fn=$SIMDIR/$fn.mut_adj

    tpc=`expr $M \* 1000`
    bsub -n10 -R rusage[mem=8] -W 48:00 -oo $log_fn \
      \time -o $out_fn.time -f "Runtime: %E\n" \
        python $BINDIR/sc_pairtree.py $data_fn \
                                          $out_fn \
                                          --seed $seed \
                                          --data-range 1 \
                                          --parallel $n_rep \
                                          --trees-per-chain $tpc \
                                          --burnin $burnin \
                                          --thinned-frac $thin_frac \
                                          --convergence-threshold $conv_thresh \
                                          --convergence-min-nsamples $conv_min_samp \
                                          --check-convergence-every $check_conv_every 
    # python $BINDIR/make_supp_figures.py $out_fn --outdir $fig_fn --seed $seed --act-tree-adj $act_mut_adj_fn
  done
  done
  done
  done
  done
}

function main {
  run_all_sims
}

main